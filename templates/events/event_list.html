{% extends "base.html" %}
{% block title %}Събития{% endblock %}

{% block content %}
<h1 class="mb-3">Всички събития</h1>
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Име</th>
        <th>Дата</th>
        <th>Категория</th>
        <th>Организация</th>
        <th>Локация</th>
        <th class="text-end">Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for event in events %}
      <tr>
        <td>{{ event.title }}</td>
        <td>{{ event.date|date:"d.m.Y" }}</td>
        <td>{{ event.get_category_display }}</td>
        <td>{{ event.organization }}</td>
        <td>{{ event.location }}</td>
        <td class="text-end">
          <a href="{% url 'events:event-detail' event.pk %}" class="btn btn-outline-primary btn-sm">Детайли</a>

          {% if user.is_authenticated and user != event.organization.user %}
            {% if event.id in applied_event_ids %}
              <button class="btn btn-secondary btn-sm ms-2" disabled>Присъединен</button>
            {% elif event.available_seats|add:0 > 0 %}
              <a href="{% url 'applications:application-create' event.pk %}" class="btn btn-success btn-sm ms-2">Присъедини се</a>
            {% else %}
              <button class="btn btn-outline-secondary btn-sm ms-2" disabled>Няма места</button>
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center text-muted">Няма събития.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
